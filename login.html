<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Login</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>
</head>
<body>
  <h2>Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ - login.html</h2>

  <input type="text" id="codeInput" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù…">
  <button onclick="sendCode()">Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù‚Ù…</button>

  <div id="status"></div>
  <div id="messages"></div>

  <script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
    const firebaseConfig = {
      apiKey: "AIzaSyDvzckvjczlDrU5FiTR1Wq_SJVzomwRuRw",
      authDomain: "ali123-5fbae.firebaseapp.com",
      databaseURL: "https://ali123-5fbae-default-rtdb.firebaseio.com",
      projectId: "ali123-5fbae",
      storageBucket: "ali123-5fbae.appspot.com",
      messagingSenderId: "969013505443",
      appId: "1:969013505443:web:34f8ed102213f0130afe16",
      measurementId: "G-LE8ZSVFW8R"
    };

    // ØªØ´ØºÙŠÙ„ Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… ÙˆØªÙˆÙ„ÙŠØ¯ Ø±Ø§Ø¨Ø·
    function sendCode() {
      const code = document.getElementById("codeInput").value;
      if (!code) return alert("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø£ÙˆÙ„Ø§");

      db.ref("codes/" + code).set({ approved: false });

      const link = window.location.origin + window.location.pathname + "?code=" + code;
      document.getElementById("status").innerHTML =
        "Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ§Ø±Ø³Ù„Ù‡ Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ:<br><a href='" + link + "'>" + link + "</a>";
    }

    // Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø·
    const urlParams = new URLSearchParams(window.location.search);
    const codeFromUrl = urlParams.get("code");
    if (codeFromUrl) {
      db.ref("codes/" + codeFromUrl).update({ approved: true });
      document.body.innerHTML = "<h3>ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ”</h3>";
    }

    // Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø£ÙˆÙ„: Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø§Ù„ÙƒÙˆØ¯
    function watchCode(code) {
      db.ref("codes/" + code + "/approved").on("value", (snap) => {
        if (snap.val() === true) {
          document.getElementById("messages").innerHTML =
            "<p>ğŸ‰ Ø¸Ù‡Ø±Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø§Øª Ø§Ù„Ø¢Ù†!</p>";
        }
      });
    }

    document.getElementById("codeInput").addEventListener("change", (e) => {
      watchCode(e.target.value);
    });
  </script>
</body>
</html>
